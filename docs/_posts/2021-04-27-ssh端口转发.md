---
title: SSH端口转发
date: 2021-04-24 11:29:53
description: SSH端口转发的两种方式 本地转发和远程转发
categories:
- 服务器
---
## ssh端口转发

1. sshd_config里要打开`AllowTcpForwarding`选项，否则`-R`远程端口转发会失败。
2. 默认转发到远程主机上的端口绑定的是`127.0.0.1`，如要绑定`0.0.0.0`需要打开sshd_config里的`GatewayPorts`选项。这个选项如果由于权限没法打开也有办法，可配合`ssh -L`将端口绑定到`0.0.0.0`，聪明的你应该能想到办法

### 本地转发

```shell
ssh -L [端口]:[目标IP]:[目标端口] [跳板机用户名]@[跳板机IP]
ssh -NL 13306:rm-2zeoogmpf8ss869f7230.mysql.rds.aliyuncs.com:3306 cloudwork@39.106.80.7
```

#### 本地转发是将 `目标ip：目标端口` 映射到 `127.0.0.1:端口`

##### 访问本地13306端口即对应远端主机 rm-2zeoogmpf8ss869f7230.mysql.rds.aliyuncs.com的3306端口



### 远端转发

```shell
ssh -NR [端口]:[目标IP]:[目标端口] [跳板机用户名]@[跳板机IP]
ssh -NR 8080:47.104.164.235:80 root@8.136.136.247
ssh -NR 39.106.80.7:13306:rm-2zeoogmpf8ss869f7230.mysql.rds.aliyuncs.com:3306 cloudwork@39.106.80.7

ssh -NR 8000:8.136.136.247:80 root@47.104.164.235

```

#### 远端转发是将 `目标ip:目标端口` 映射到 `跳板机的ip：端口`

